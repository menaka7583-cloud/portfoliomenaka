<script>
const canvas = document.getElementById("animationCanvas");
const context = canvas.getContext("2d");

const frameCount = 240;
const images = [];
let loadedImages = 0;

function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* Load Images */
for(let i=1; i<=frameCount; i++){
    const img = new Image();
    img.src = `frames/ezgif-frame-${String(i).padStart(3,'0')}.jpg`;

    img.onload = () => {
        loadedImages++;
        if(loadedImages === 1){
            renderFrame(0);
        }
    };

    img.onerror = () => {
        console.log("Image not found:", img.src);
    };

    images.push(img);
}

function renderFrame(index){
    if(images[index] && images[index].complete){
        context.clearRect(0,0,canvas.width,canvas.height);

        const img = images[index];

        const scale = Math.max(
            canvas.width / img.width,
            canvas.height / img.height
        );

        const x = (canvas.width / 2) - (img.width / 2) * scale;
        const y = (canvas.height / 2) - (img.height / 2) * scale;

        context.drawImage(
            img,
            x,
            y,
            img.width * scale,
            img.height * scale
        );
    }
}

window.addEventListener("scroll", () => {
    const scrollTop = window.scrollY;
    const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;

    if(scrollHeight <= 0) return;

    const scrollFraction = scrollTop / scrollHeight;
    const frameIndex = Math.min(
        frameCount - 1,
        Math.floor(scrollFraction * (frameCount - 1))
    );

    renderFrame(frameIndex);
});
</script>
